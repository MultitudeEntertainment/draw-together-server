<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Quiz Capitales ‚Äì Trouve le pays</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
    body {
        margin: 0;
        background: #0d1117;
        color: white;
        font-family: Arial, sans-serif;
        height: 100vh;
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
    }

    /* ACCUEIL carr√© */
    #home {
        width: 350px;
        height: 350px;
        background: #161b22;
        border-radius: 20px;
        box-shadow: 0 0 20px rgba(0,0,0,0.4);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 20px;
        text-align: center;
        padding: 20px;
    }

    .btn {
        padding: 12px 20px;
        border-radius: 10px;
        border: none;
        cursor: pointer;
        width: 200px;
        font-size: 1.1rem;
        color: white;
    }

    .easy { background: #22c55e; }
    .medium { background: #f59e0b; }
    .hard { background: #ef4444; }

    /* QUIZ */
    #quiz {
        width: 100%;
        height: 100%;
        display: none;
        flex-direction: column;
    }

    #question-box {
        background: #161b22;
        padding: 10px 15px;
        text-align: center;
        font-size: 1.1rem;
        display: flex;
        flex-direction: column;
        gap: 4px;
    }

    #meta {
        font-size: 0.9rem;
        color: #9ca3af;
    }

    #map {
        flex: 1;
        width: 100%;
    }

    /* RESULTAT */
    #result {
        display: none;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        gap: 20px;
        text-align: center;
    }

    #restart {
        background: #3b82f6;
        padding: 12px 20px;
        border-radius: 10px;
        border: none;
        color: white;
        cursor: pointer;
    }
</style>
</head>
<body>

<!-- ACCUEIL -->
<div id="home">
    <h2>üåç Quiz des Capitales</h2>
    <p>Clique le pays correspondant √† la capitale</p>

    <button class="btn easy" onclick="startGame('easy')">Facile</button>
    <button class="btn medium" onclick="startGame('medium')">Moyen</button>
    <button class="btn hard" onclick="startGame('hard')">Difficile</button>
</div>

<!-- QUIZ -->
<div id="quiz">
    <div id="question-box">
        <div id="meta">
            Question <span id="qnum">1</span> / <span id="qtotal">20</span> ¬∑ Score : <span id="qscore">0</span>
        </div>
        <div>
            Capitale : <span id="capital"></span>
        </div>
    </div>
    <div id="map"></div>
</div>

<!-- RESULTAT -->
<div id="result">
    <h1 id="score"></h1>
    <p>Vous pouvez montrer votre score aux autres membres du serveur</p>
    <button id="restart" onclick="goHome()">Retour √† l'accueil</button>
</div>

<script>
/* ---------------------------
   PAYS + CAPITALES
----------------------------*/
const COUNTRIES = [
    { name: "France",   capital: "Paris",        difficulty: "easy" },
    { name: "Espagne",  capital: "Madrid",       difficulty: "easy" },
    { name: "Italie",   capital: "Rome",         difficulty: "easy" },
    { name: "Allemagne",capital: "Berlin",       difficulty: "easy" },
    { name: "Portugal", capital: "Lisbonne",     difficulty: "medium" },
    { name: "Turquie",  capital: "Ankara",       difficulty: "medium" },
    { name: "√âgypte",   capital: "Le Caire",     difficulty: "medium" },
    { name: "Mongolie", capital: "Oulan-Bator",  difficulty: "hard" },
    { name: "Tanzanie", capital: "Dodoma",       difficulty: "hard" }
];

/* ---------------------------
   GEOJSON int√©gr√© (simplifi√©)
----------------------------*/
const GEOJSON = {
"type":"FeatureCollection",
"features":[
    {"type":"Feature","properties":{"ADMIN":"France"},"geometry":{"type":"Polygon","coordinates":[[[ -5, 42 ],[ 8, 42 ],[ 8, 51 ],[ -5, 51 ],[ -5, 42 ]]]}},
    {"type":"Feature","properties":{"ADMIN":"Espagne"},"geometry":{"type":"Polygon","coordinates":[[[ -10, 36 ],[ 4, 36 ],[ 4, 44 ],[ -10, 44 ],[ -10, 36 ]]]}},
    {"type":"Feature","properties":{"ADMIN":"Italie"},"geometry":{"type":"Polygon","coordinates":[[[ 8, 37 ],[ 19, 37 ],[ 19, 47 ],[ 8, 47 ],[ 8, 37 ]]]}},
    {"type":"Feature","properties":{"ADMIN":"Allemagne"},"geometry":{"type":"Polygon","coordinates":[[[ 5, 47 ],[ 15, 47 ],[ 15, 55 ],[ 5, 55 ],[ 5, 47 ]]]}},
    {"type":"Feature","properties":{"ADMIN":"Portugal"},"geometry":{"type":"Polygon","coordinates":[[[ -10, 36 ],[ -6, 36 ],[ -6, 43 ],[ -10, 43 ],[ -10, 36 ]]]}},
    {"type":"Feature","properties":{"ADMIN":"Turquie"},"geometry":{"type":"Polygon","coordinates":[[[ 26, 36 ],[ 45, 36 ],[ 45, 42 ],[ 26, 42 ],[ 26, 36 ]]]}},
    {"type":"Feature","properties":{"ADMIN":"√âgypte"},"geometry":{"type":"Polygon","coordinates":[[[ 25, 22 ],[ 36, 22 ],[ 36, 32 ],[ 25, 32 ],[ 25, 22 ]]]}},
    {"type":"Feature","properties":{"ADMIN":"Mongolie"},"geometry":{"type":"Polygon","coordinates":[[[ 87, 41 ],[ 120, 41 ],[ 120, 52 ],[ 87, 52 ],[ 87, 41 ]]]}},
    {"type":"Feature","properties":{"ADMIN":"Tanzanie"},"geometry":{"type":"Polygon","coordinates":[[[ 29, -12 ],[ 40, -12 ],[ 40, 0 ],[ 29, 0 ],[ 29, -12 ]]]}}
]};

/* ---------------------------
   VARIABLES DU JEU
----------------------------*/
let map;
let geojsonLayer;
let difficulty;
let questions = [];
let index = 0;
let score = 0;
let totalQuestions = 0;

/* ---------------------------
   INITIALISATION CARTE
----------------------------*/
function initMap() {
    map = L.map('map').setView([20, 0], 2);

    // Fond sans labels (pas de villes)
    L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}.png', {
        maxZoom: 6
    }).addTo(map);

    geojsonLayer = L.geoJSON(GEOJSON, {
        style: {
            color: "#555",
            weight: 1,
            fillOpacity: 0.1
        },
        onEachFeature: (feature, layer) => {
            layer.on("click", () => onCountryClick(feature.properties.ADMIN));
        }
    }).addTo(map);
}

/* ---------------------------
   D√âMARRER LE JEU
----------------------------*/
function startGame(diff) {
    difficulty = diff;
    score = 0;
    index = 0;

    let pool = COUNTRIES.filter(c => {
        if (diff === "easy") return c.difficulty === "easy";
        if (diff === "medium") return c.difficulty !== "hard";
        return true;
    });

    pool = pool.sort(() => Math.random() - 0.5);
    totalQuestions = Math.min(20, pool.length);
    questions = pool.slice(0, totalQuestions);

    document.getElementById("home").style.display = "none";
    document.getElementById("quiz").style.display = "flex";

    document.getElementById("qtotal").textContent = totalQuestions;

    if (!map) initMap();

    loadQuestion();
}

/* ---------------------------
   CHARGER QUESTION
----------------------------*/
function loadQuestion() {
    const q = questions[index];
    if (!q) {
        endGame();
        return;
    }
    document.getElementById("capital").textContent = q.capital;
    document.getElementById("qnum").textContent = index + 1;
    document.getElementById("qscore").textContent = score;
}

/* ---------------------------
   CLIQUE SUR UN PAYS
----------------------------*/
function onCountryClick(clickedName) {
    const q = questions[index];
    if (!q) return;

    if (clickedName === q.name) {
        score++;
        highlightCountry(clickedName, "green");
    } else {
        highlightCountry(clickedName, "red");
        highlightCountry(q.name, "green");
    }

    index++;
    if (index >= totalQuestions) {
        setTimeout(() => {
            endGame();
        }, 800);
        return;
    }

    setTimeout(() => {
        resetStyles();
        loadQuestion();
    }, 1200);
}

/* ---------------------------
   COLORIER UN PAYS
----------------------------*/
function highlightCountry(name, color) {
    geojsonLayer.eachLayer(layer => {
        if (layer.feature.properties.ADMIN === name) {
            layer.setStyle({
                fillColor: color,
                fillOpacity: 0.5,
                color: color
            });
        }
    });
}

/* ---------------------------
   RESET STYLE
----------------------------*/
function resetStyles() {
    geojsonLayer.eachLayer(layer => {
        layer.setStyle({
            color: "#555",
            weight: 1,
            fillOpacity: 0.1
        });
    });
}

/* ---------------------------
   FIN DU JEU
----------------------------*/
function endGame() {
    document.getElementById("quiz").style.display = "none";
    document.getElementById("result").style.display = "flex";

    document.getElementById("score").textContent = `Score : ${score} / ${totalQuestions}`;
}

/* ---------------------------
   RETOUR ACCUEIL
----------------------------*/
function goHome() {
    document.getElementById("result").style.display = "none";
    document.getElementById("home").style.display = "flex";
}
</script>

</body>
</html>
