<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Quiz Capitales du Monde</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --bg: #0f172a;
            --card: #111827;
            --accent: #3b82f6;
            --accent-soft: #1d4ed8;
            --text: #e5e7eb;
            --muted: #9ca3af;
            --good: #22c55e;
            --bad: #ef4444;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        }

        body {
            background: radial-gradient(circle at top, #1f2937 0, #020617 55%, #000 100%);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .app {
            width: 100%;
            max-width: 900px;
            background: linear-gradient(145deg, rgba(15,23,42,0.98), rgba(15,23,42,0.9));
            border-radius: 18px;
            box-shadow:
                0 25px 60px rgba(0,0,0,0.7),
                0 0 0 1px rgba(148,163,184,0.15);
            padding: 24px 22px 26px;
            position: relative;
            overflow: hidden;
        }

        .app::before {
            content: "";
            position: absolute;
            inset: -40%;
            background:
                radial-gradient(circle at 0% 0%, rgba(59,130,246,0.12), transparent 55%),
                radial-gradient(circle at 100% 0%, rgba(236,72,153,0.12), transparent 55%);
            opacity: 0.9;
            pointer-events: none;
        }

        .app-inner {
            position: relative;
            z-index: 1;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
            gap: 10px;
        }

        .title-block {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        h1 {
            font-size: 1.6rem;
            letter-spacing: 0.03em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        h1 span.logo {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 30px;
            height: 30px;
            border-radius: 999px;
            background: radial-gradient(circle at 30% 20%, #facc15, #f97316);
            box-shadow: 0 0 18px rgba(250,204,21,0.7);
            font-size: 1.1rem;
        }

        .subtitle {
            font-size: 0.9rem;
            color: var(--muted);
        }

        .badge {
            font-size: 0.75rem;
            padding: 4px 9px;
            border-radius: 999px;
            border: 1px solid rgba(148,163,184,0.4);
            color: var(--muted);
            background: rgba(15,23,42,0.8);
        }

        main {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        .card {
            background: radial-gradient(circle at top left, rgba(15,118,110,0.18), transparent 55%),
                        radial-gradient(circle at bottom right, rgba(59,130,246,0.18), transparent 55%),
                        var(--card);
            border-radius: 16px;
            padding: 18px 18px 16px;
            border: 1px solid rgba(148,163,184,0.25);
        }

        .card-header {
            margin-bottom: 14px;
        }

        .card-title {
            font-size: 1.1rem;
            margin-bottom: 4px;
        }

        .card-text {
            font-size: 0.9rem;
            color: var(--muted);
        }

        .difficulty-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin-top: 14px;
        }

        .btn {
            border: none;
            border-radius: 999px;
            padding: 9px 14px;
            font-size: 0.95rem;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            transition: transform 0.08s ease, box-shadow 0.08s ease, background 0.12s ease, border-color 0.12s ease;
            white-space: nowrap;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent), var(--accent-soft));
            color: white;
            box-shadow: 0 10px 25px rgba(37,99,235,0.45);
        }

        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 14px 30px rgba(37,99,235,0.6);
        }

        .btn-ghost {
            background: rgba(15,23,42,0.9);
            color: var(--muted);
            border: 1px solid rgba(148,163,184,0.4);
        }

        .btn-ghost:hover {
            border-color: rgba(248,250,252,0.7);
            color: #e5e7eb;
            transform: translateY(-1px);
        }

        .btn-sm {
            padding: 6px 10px;
            font-size: 0.8rem;
        }

        .difficulty-easy {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            box-shadow: 0 10px 25px rgba(34,197,94,0.45);
        }

        .difficulty-medium {
            background: linear-gradient(135deg, #f97316, #ea580c);
            box-shadow: 0 10px 25px rgba(249,115,22,0.45);
        }

        .difficulty-hard {
            background: linear-gradient(135deg, #ef4444, #b91c1c);
            box-shadow: 0 10px 25px rgba(239,68,68,0.45);
        }

        .meta-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: var(--muted);
            margin-bottom: 8px;
        }

        .pill {
            padding: 3px 8px;
            border-radius: 999px;
            border: 1px solid rgba(148,163,184,0.4);
        }

        .question-block {
            display: grid;
            grid-template-columns: minmax(0, 1.4fr) minmax(0, 1fr);
            gap: 14px;
        }

        @media (max-width: 720px) {
            .question-block {
                grid-template-columns: 1fr;
            }
        }

        .country-card {
            background: rgba(15,23,42,0.9);
            border-radius: 14px;
            padding: 12px 12px 10px;
            border: 1px solid rgba(148,163,184,0.35);
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .country-flag {
            font-size: 2.2rem;
        }

        .country-name {
            font-size: 1.05rem;
            font-weight: 600;
        }

        .country-region {
            font-size: 0.8rem;
            color: var(--muted);
        }

        .question-text {
            margin-top: 4px;
            font-size: 0.95rem;
        }

        .answers {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 6px;
        }

        .answer-btn {
            width: 100%;
            justify-content: flex-start;
            padding: 8px 11px;
            border-radius: 10px;
            background: rgba(15,23,42,0.9);
            border: 1px solid rgba(148,163,184,0.4);
            color: var(--text);
            font-size: 0.9rem;
        }

        .answer-btn:hover {
            border-color: rgba(248,250,252,0.8);
            background: rgba(15,23,42,0.95);
        }

        .answer-btn.correct {
            border-color: rgba(34,197,94,0.9);
            background: rgba(22,163,74,0.18);
        }

        .answer-btn.wrong {
            border-color: rgba(239,68,68,0.9);
            background: rgba(185,28,28,0.18);
        }

        .status-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 10px;
            font-size: 0.85rem;
        }

        .status-message {
            min-height: 18px;
        }

        .status-good {
            color: var(--good);
        }

        .status-bad {
            color: var(--bad);
        }

        .info-box {
            margin-top: 10px;
            padding: 8px 10px;
            border-radius: 10px;
            background: rgba(15,23,42,0.9);
            border: 1px dashed rgba(148,163,184,0.6);
            font-size: 0.8rem;
            color: var(--muted);
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            border-radius: 999px;
            background: rgba(15,23,42,0.9);
            overflow: hidden;
            margin-top: 6px;
        }

        .progress-fill {
            height: 100%;
            width: 0%;
            border-radius: inherit;
            background: linear-gradient(90deg, #22c55e, #facc15, #ef4444);
            transition: width 0.25s ease-out;
        }

        .score-big {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 4px;
        }

        .score-detail {
            font-size: 0.9rem;
            color: var(--muted);
            margin-bottom: 10px;
        }

        .share-note {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #e5e7eb;
            padding: 8px 10px;
            border-radius: 10px;
            background: rgba(15,23,42,0.95);
            border: 1px solid rgba(148,163,184,0.5);
        }

        .footer-row {
            margin-top: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.75rem;
            color: var(--muted);
        }

        .footer-row a {
            color: var(--muted);
            text-decoration: none;
            border-bottom: 1px dotted rgba(148,163,184,0.6);
        }

        .footer-row a:hover {
            color: #e5e7eb;
            border-bottom-style: solid;
        }
    </style>
</head>
<body>
<div class="app">
    <div class="app-inner">
        <header>
            <div class="title-block">
                <h1>
                    <span class="logo">üåç</span>
                    Quiz des Capitales
                </h1>
                <div class="subtitle">Testez vos connaissances sur les capitales du monde, seul ou avec votre serveur.</div>
            </div>
            <div class="badge">HTML ‚Ä¢ GitHub Pages ready</div>
        </header>

        <main>
            <!-- √âcran d'accueil -->
            <section id="screen-home" class="screen active">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Bienvenue dans le quiz des capitales</div>
                        <div class="card-text">
                            Choisissez une difficult√©, r√©pondez √† 20 questions, et comparez vos scores avec les autres.
                        </div>
                    </div>
                    <div class="difficulty-buttons">
                        <button class="btn difficulty-easy" data-difficulty="easy">
                            Facile ¬∑ Pays tr√®s connus
                        </button>
                        <button class="btn difficulty-medium" data-difficulty="medium">
                            Moyen ¬∑ M√©lange vari√©
                        </button>
                        <button class="btn difficulty-hard" data-difficulty="hard">
                            Difficile ¬∑ Pays plus rares
                        </button>
                    </div>
                </div>
            </section>

            <!-- √âcran de quiz -->
            <section id="screen-quiz" class="screen">
                <div class="card">
                    <div class="meta-row">
                        <div>
                            <span id="difficulty-label" class="pill">Difficult√©</span>
                        </div>
                        <div>
                            Question <span id="question-number">1</span>/20 ¬∑
                            Score : <span id="score-display">0</span>
                        </div>
                    </div>

                    <div class="progress-bar">
                        <div id="progress-fill" class="progress-fill"></div>
                    </div>

                    <div class="question-block">
                        <div class="country-card">
                            <div class="country-flag" id="country-flag">üè≥Ô∏è</div>
                            <div class="country-name" id="country-name">Pays</div>
                            <div class="country-region" id="country-region">R√©gion</div>
                            <div class="question-text">
                                Quelle est la capitale de ce pays ?
                            </div>
                        </div>

                        <div>
                            <div class="answers" id="answers-container">
                                <!-- Boutons de r√©ponses g√©n√©r√©s en JS -->
                            </div>

                            <div class="status-row">
                                <div id="status-message" class="status-message"></div>
                                <button id="next-button" class="btn btn-sm btn-ghost" disabled>Question suivante</button>
                            </div>

                            <div id="info-box" class="info-box" style="display:none;"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- √âcran de r√©sultat -->
            <section id="screen-result" class="screen">
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">R√©sultat du quiz</div>
                        <div class="card-text">
                            Bravo d‚Äô√™tre all√© jusqu‚Äôau bout. Voici votre score pour cette s√©rie de 20 questions.
                        </div>
                    </div>

                    <div>
                        <div class="score-big" id="final-score">0 / 20</div>
                        <div class="score-detail" id="final-comment"></div>

                        <div class="share-note">
                            Vous pouvez montrer votre score aux autres membres du serveur
                            pour voir qui conna√Æt le mieux les capitales du monde.
                        </div>

                        <div style="margin-top: 14px; display:flex; gap:8px; flex-wrap:wrap;">
                            <button id="restart-button" class="btn btn-primary">
                                Revenir √† l‚Äôaccueil et recommencer
                            </button>
                            <button id="play-same-difficulty" class="btn btn-ghost">
                                Rejouer avec la m√™me difficult√©
                            </button>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <div class="footer-row">
            <div>20 questions par partie ¬∑ 3 choix par question</div>
            <div>Projet perso ¬∑ H√©bergeable sur GitHub Pages</div>
        </div>
    </div>
</div>

<script>
    // --- Donn√©es des pays ---
    // Chaque entr√©e : nom, capitale, drapeau (emoji), r√©gion
    const COUNTRIES = [
        // Facile (pays tr√®s connus)
        { name: "France", capital: "Paris", flag: "üá´üá∑", region: "Europe de l'Ouest", difficulty: "easy" },
        { name: "Allemagne", capital: "Berlin", flag: "üá©üá™", region: "Europe centrale", difficulty: "easy" },
        { name: "Espagne", capital: "Madrid", flag: "üá™üá∏", region: "Europe du Sud", difficulty: "easy" },
        { name: "Italie", capital: "Rome", flag: "üáÆüáπ", region: "Europe du Sud", difficulty: "easy" },
        { name: "Royaume-Uni", capital: "Londres", flag: "üá¨üáß", region: "Europe de l'Ouest", difficulty: "easy" },
        { name: "√âtats-Unis", capital: "Washington", flag: "üá∫üá∏", region: "Am√©rique du Nord", difficulty: "easy" },
        { name: "Canada", capital: "Ottawa", flag: "üá®üá¶", region: "Am√©rique du Nord", difficulty: "easy" },
        { name: "Br√©sil", capital: "Brasilia", flag: "üáßüá∑", region: "Am√©rique du Sud", difficulty: "easy" },
        { name: "Mexique", capital: "Mexico", flag: "üá≤üáΩ", region: "Am√©rique du Nord", difficulty: "easy" },
        { name: "Japon", capital: "Tokyo", flag: "üáØüáµ", region: "Asie de l'Est", difficulty: "easy" },
        { name: "Chine", capital: "P√©kin", flag: "üá®üá≥", region: "Asie de l'Est", difficulty: "easy" },
        { name: "Russie", capital: "Moscou", flag: "üá∑üá∫", region: "Europe / Asie", difficulty: "easy" },
        { name: "Australie", capital: "Canberra", flag: "üá¶üá∫", region: "Oc√©anie", difficulty: "easy" },
        { name: "Inde", capital: "New Delhi", flag: "üáÆüá≥", region: "Asie du Sud", difficulty: "easy" },
        { name: "Argentine", capital: "Buenos Aires", flag: "üá¶üá∑", region: "Am√©rique du Sud", difficulty: "easy" },

        // Moyen (m√©lange)
        { name: "Portugal", capital: "Lisbonne", flag: "üáµüáπ", region: "Europe du Sud-Ouest", difficulty: "medium" },
        { name: "Pays-Bas", capital: "Amsterdam", flag: "üá≥üá±", region: "Europe de l'Ouest", difficulty: "medium" },
        { name: "Belgique", capital: "Bruxelles", flag: "üáßüá™", region: "Europe de l'Ouest", difficulty: "medium" },
        { name: "Suisse", capital: "Berne", flag: "üá®üá≠", region: "Europe centrale", difficulty: "medium" },
        { name: "Su√®de", capital: "Stockholm", flag: "üá∏üá™", region: "Europe du Nord", difficulty: "medium" },
        { name: "Norv√®ge", capital: "Oslo", flag: "üá≥üá¥", region: "Europe du Nord", difficulty: "medium" },
        { name: "Finlande", capital: "Helsinki", flag: "üá´üáÆ", region: "Europe du Nord", difficulty: "medium" },
        { name: "Pologne", capital: "Varsovie", flag: "üáµüá±", region: "Europe centrale", difficulty: "medium" },
        { name: "Gr√®ce", capital: "Ath√®nes", flag: "üá¨üá∑", region: "Europe du Sud", difficulty: "medium" },
        { name: "Turquie", capital: "Ankara", flag: "üáπüá∑", region: "Europe / Asie", difficulty: "medium" },
        { name: "√âgypte", capital: "Le Caire", flag: "üá™üá¨", region: "Afrique du Nord", difficulty: "medium" },
        { name: "Afrique du Sud", capital: "Pretoria (adm.)", flag: "üáøüá¶", region: "Afrique australe", difficulty: "medium" },
        { name: "Nig√©ria", capital: "Abuja", flag: "üá≥üá¨", region: "Afrique de l'Ouest", difficulty: "medium" },
        { name: "Arabie saoudite", capital: "Riyad", flag: "üá∏üá¶", region: "Moyen-Orient", difficulty: "medium" },
        { name: "Indon√©sie", capital: "Jakarta", flag: "üáÆüá©", region: "Asie du Sud-Est", difficulty: "medium" },
        { name: "Tha√Ølande", capital: "Bangkok", flag: "üáπüá≠", region: "Asie du Sud-Est", difficulty: "medium" },
        { name: "Cor√©e du Sud", capital: "S√©oul", flag: "üá∞üá∑", region: "Asie de l'Est", difficulty: "medium" },
        { name: "Nouvelle-Z√©lande", capital: "Wellington", flag: "üá≥üáø", region: "Oc√©anie", difficulty: "medium" },
        { name: "Colombie", capital: "Bogota", flag: "üá®üá¥", region: "Am√©rique du Sud", difficulty: "medium" },
        { name: "Chili", capital: "Santiago", flag: "üá®üá±", region: "Am√©rique du Sud", difficulty: "medium" },

        // Difficile (pays moins √©vidents)
        { name: "Kazakhstan", capital: "Astana", flag: "üá∞üáø", region: "Asie centrale", difficulty: "hard" },
        { name: "Ouzb√©kistan", capital: "Tachkent", flag: "üá∫üáø", region: "Asie centrale", difficulty: "hard" },
        { name: "Mongolie", capital: "Oulan-Bator", flag: "üá≤üá≥", region: "Asie de l'Est", difficulty: "hard" },
        { name: "Sri Lanka", capital: "Sri Jayawardenepura Kotte", flag: "üá±üá∞", region: "Asie du Sud", difficulty: "hard" },
        { name: "Bhoutan", capital: "Thimphou", flag: "üáßüáπ", region: "Asie du Sud", difficulty: "hard" },
        { name: "N√©pal", capital: "Katmandou", flag: "üá≥üáµ", region: "Asie du Sud", difficulty: "hard" },
        { name: "Bolivie", capital: "Sucre (const.)", flag: "üáßüá¥", region: "Am√©rique du Sud", difficulty: "hard" },
        { name: "Paraguay", capital: "Asuncion", flag: "üáµüáæ", region: "Am√©rique du Sud", difficulty: "hard" },
        { name: "Uruguay", capital: "Montevideo", flag: "üá∫üáæ", region: "Am√©rique du Sud", difficulty: "hard" },
        { name: "√âthiopie", capital: "Addis-Abeba", flag: "üá™üáπ", region: "Afrique de l'Est", difficulty: "hard" },
        { name: "Kenya", capital: "Nairobi", flag: "üá∞üá™", region: "Afrique de l'Est", difficulty: "hard" },
        { name: "Tanzanie", capital: "Dodoma", flag: "üáπüáø", region: "Afrique de l'Est", difficulty: "hard" },
        { name: "Angola", capital: "Luanda", flag: "üá¶üá¥", region: "Afrique australe", difficulty: "hard" },
        { name: "Mozambique", capital: "Maputo", flag: "üá≤üáø", region: "Afrique australe", difficulty: "hard" },
        { name: "Qatar", capital: "Doha", flag: "üá∂üá¶", region: "Moyen-Orient", difficulty: "hard" },
        { name: "√âmirats arabes unis", capital: "Abou Dabi", flag: "üá¶üá™", region: "Moyen-Orient", difficulty: "hard" },
        { name: "Jordanie", capital: "Amman", flag: "üáØüá¥", region: "Moyen-Orient", difficulty: "hard" },
        { name: "Islande", capital: "Reykjavik", flag: "üáÆüá∏", region: "Europe du Nord", difficulty: "hard" },
        { name: "Lettonie", capital: "Riga", flag: "üá±üáª", region: "Europe du Nord", difficulty: "hard" },
        { name: "Lituanie", capital: "Vilnius", flag: "üá±üáπ", region: "Europe du Nord", difficulty: "hard" },
        { name: "Slov√©nie", capital: "Ljubljana", flag: "üá∏üáÆ", region: "Europe centrale", difficulty: "hard" },
        { name: "Slovaquie", capital: "Bratislava", flag: "üá∏üá∞", region: "Europe centrale", difficulty: "hard" },
        { name: "Croatie", capital: "Zagreb", flag: "üá≠üá∑", region: "Europe du Sud", difficulty: "hard" },
        { name: "Serbie", capital: "Belgrade", flag: "üá∑üá∏", region: "Europe du Sud-Est", difficulty: "hard" }
    ];

    // --- √âtat du jeu ---
    let currentDifficulty = "easy";
    let questionPool = [];
    let currentQuestionIndex = 0;
    let score = 0;
    let currentQuestion = null;

    const TOTAL_QUESTIONS = 20;

    // --- S√©lecteurs ---
    const screenHome = document.getElementById("screen-home");
    const screenQuiz = document.getElementById("screen-quiz");
    const screenResult = document.getElementById("screen-result");

    const difficultyButtons = document.querySelectorAll(".difficulty-buttons .btn");
    const difficultyLabel = document.getElementById("difficulty-label");
    const questionNumberSpan = document.getElementById("question-number");
    const scoreDisplay = document.getElementById("score-display");
    const progressFill = document.getElementById("progress-fill");

    const countryFlag = document.getElementById("country-flag");
    const countryName = document.getElementById("country-name");
    const countryRegion = document.getElementById("country-region");
    const answersContainer = document.getElementById("answers-container");
    const statusMessage = document.getElementById("status-message");
    const nextButton = document.getElementById("next-button");
    const infoBox = document.getElementById("info-box");

    const finalScore = document.getElementById("final-score");
    const finalComment = document.getElementById("final-comment");
    const restartButton = document.getElementById("restart-button");
    const playSameDifficultyButton = document.getElementById("play-same-difficulty");

    // --- Utilitaires ---
    function shuffleArray(arr) {
        const a = arr.slice();
        for (let i = a.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [a[i], a[j]] = [a[j], a[i]];
        }
        return a;
    }

    function pickRandom(arr, n) {
        return shuffleArray(arr).slice(0, n);
    }

    function setScreen(screen) {
        screenHome.classList.remove("active");
        screenQuiz.classList.remove("active");
        screenResult.classList.remove("active");

        screen.classList.add("active");
    }

    function difficultyLabelText(diff) {
        if (diff === "easy") return "Difficult√© : Facile";
        if (diff === "medium") return "Difficult√© : Moyen";
        if (diff === "hard") return "Difficult√© : Difficile";
        return "Difficult√©";
    }

    function difficultyLabelColor(diff) {
        if (diff === "easy") return "#22c55e";
        if (diff === "medium") return "#f97316";
        if (diff === "hard") return "#ef4444";
        return "#e5e7eb";
    }

    // --- Logique du quiz ---
    function startGame(difficulty) {
        currentDifficulty = difficulty;
        score = 0;
        currentQuestionIndex = 0;

        // Construire le pool selon la difficult√©
        const easy = COUNTRIES.filter(c => c.difficulty === "easy");
        const medium = COUNTRIES.filter(c => c.difficulty === "medium");
        const hard = COUNTRIES.filter(c => c.difficulty === "hard");

        if (difficulty === "easy") {
            questionPool = pickRandom(easy, Math.min(TOTAL_QUESTIONS, easy.length));
        } else if (difficulty === "medium") {
            const pool = easy.concat(medium);
            questionPool = pickRandom(pool, Math.min(TOTAL_QUESTIONS, pool.length));
        } else {
            const pool = easy.concat(medium, hard);
            questionPool = pickRandom(pool, Math.min(TOTAL_QUESTIONS, pool.length));
        }

        difficultyLabel.textContent = difficultyLabelText(difficulty);
        difficultyLabel.style.borderColor = difficultyLabelColor(difficulty);
        difficultyLabel.style.color = difficultyLabelColor(difficulty);

        scoreDisplay.textContent = score;
        updateProgress();
        loadQuestion();
        setScreen(screenQuiz);
    }

    function updateProgress() {
        const percent = (currentQuestionIndex / TOTAL_QUESTIONS) * 100;
        progressFill.style.width = percent + "%";
        questionNumberSpan.textContent = Math.min(currentQuestionIndex + 1, TOTAL_QUESTIONS);
    }

    function loadQuestion() {
        statusMessage.textContent = "";
        statusMessage.className = "status-message";
        infoBox.style.display = "none";
        infoBox.textContent = "";
        nextButton.disabled = true;

        currentQuestion = questionPool[currentQuestionIndex];

        if (!currentQuestion) {
            endGame();
            return;
        }

        countryFlag.textContent = currentQuestion.flag;
        countryName.textContent = currentQuestion.name;
        countryRegion.textContent = currentQuestion.region;

        // G√©n√©rer 2 mauvaises r√©ponses + 1 bonne
        const otherCountries = COUNTRIES.filter(c => c.name !== currentQuestion.name);
        const wrongOptions = pickRandom(otherCountries, 2);
        const options = shuffleArray([
            { text: currentQuestion.capital, correct: true },
            { text: wrongOptions[0].capital, correct: false },
            { text: wrongOptions[1].capital, correct: false }
        ]);

        answersContainer.innerHTML = "";
        options.forEach(opt => {
            const btn = document.createElement("button");
            btn.className = "btn answer-btn";
            btn.textContent = opt.text;
            btn.dataset.correct = opt.correct ? "true" : "false";
            btn.addEventListener("click", () => handleAnswer(btn));
            answersContainer.appendChild(btn);
        });
    }

    function handleAnswer(button) {
        // Emp√™cher de r√©pondre plusieurs fois
        const allButtons = answersContainer.querySelectorAll("button");
        allButtons.forEach(b => b.disabled = true);

        const isCorrect = button.dataset.correct === "true";
        if (isCorrect) {
            button.classList.add("correct");
            statusMessage.textContent = "Bonne r√©ponse !";
            statusMessage.classList.add("status-good");
            score++;
            scoreDisplay.textContent = score;
        } else {
            button.classList.add("wrong");
            statusMessage.textContent = "Mauvaise r√©ponse.";
            statusMessage.classList.add("status-bad");

            // Marquer la bonne r√©ponse
            allButtons.forEach(b => {
                if (b.dataset.correct === "true") {
                    b.classList.add("correct");
                }
            });
        }

        // Afficher la petite fiche pays + emplacement
        infoBox.style.display = "block";
        infoBox.innerHTML =
            "<strong>" + currentQuestion.name + "</strong><br>" +
            "Capitale : <strong>" + currentQuestion.capital + "</strong><br>" +
            "R√©gion : " + currentQuestion.region + "<br>" +
            "<span style='opacity:0.8;'>Imaginez la carte : la capitale se situe dans cette zone du pays.</span>";

        nextButton.disabled = false;
    }

    function nextQuestion() {
        currentQuestionIndex++;
        if (currentQuestionIndex >= TOTAL_QUESTIONS || currentQuestionIndex >= questionPool.length) {
            endGame();
        } else {
            updateProgress();
            loadQuestion();
        }
    }

    function endGame() {
        setScreen(screenResult);
        finalScore.textContent = score + " / " + TOTAL_QUESTIONS;

        let comment;
        const ratio = score / TOTAL_QUESTIONS;
        if (ratio === 1) {
            comment = "Score parfait ! Vous √™tes une encyclop√©die vivante des capitales.";
        } else if (ratio >= 0.75) {
            comment = "Excellent ! Vous ma√Ætrisez tr√®s bien les capitales du monde.";
        } else if (ratio >= 0.5) {
            comment = "Pas mal du tout. Encore un peu d‚Äôentra√Ænement et ce sera parfait.";
        } else {
            comment = "Bon d√©but ! Rejouez quelques parties pour progresser.";
        }
        finalComment.textContent = comment;
    }

    // --- √âv√©nements ---
    difficultyButtons.forEach(btn => {
        btn.addEventListener("click", () => {
            const diff = btn.dataset.difficulty;
            startGame(diff);
        });
    });

    nextButton.addEventListener("click", () => {
        nextQuestion();
    });

    restartButton.addEventListener("click", () => {
        setScreen(screenHome);
    });

    playSameDifficultyButton.addEventListener("click", () => {
        startGame(currentDifficulty);
    });
</script>
</body>
</html>
